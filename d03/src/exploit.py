from bs4 import BeautifulSoup
import os

materials_dir = os.path.join(os.path.dirname(__file__), '..', 'materials')

# Открываем исходный файл
with open(os.path.join(materials_dir, 'evilcorp.html'), 'r') as file:
    content = file.read()

# Создаем объект BeautifulSoup для парсинга HTML
soup = BeautifulSoup(content, 'html.parser')

# Изменяем заголовок страницы
title_tag = soup.find('title')
title_tag.string = 'Evil Corp - Stealing your money every day'

# Находим имя пользователя и вставляем новый тег <h1>
username = soup.find('span', class_='name').text
h1_tag = soup.new_tag('h1')
h1_tag.string = f"Mr. Robot, you are hacked!"
body_tag = soup.find('body')
body_tag.insert(0, h1_tag)

# Внедряем скрипт Трентона
script_tag = soup.new_tag('script')
script_tag.string = """
    hacked = function() {
        alert('hacked');
    }
    window.addEventListener('load',
      function() {
        var f = document.querySelector("form");
        f.setAttribute("onsubmit", "hacked()");
      },
      false
    );
"""
body_tag.append(script_tag)

# Изменяем ссылку в нижней части страницы
link_tag = soup.find('a', href='https://mrrobot.fandom.com/wiki/E_Corp')
link_tag['href'] = 'https://mrrobot.fandom.com/wiki/Fsociety'
link_tag.string = 'Fsociety'

# Сохраняем измененный HTML в новый файл
output_file = os.path.join(materials_dir, 'evilcorp_hacked.html')
with open(output_file, 'w') as file:
    file.write(str(soup))

